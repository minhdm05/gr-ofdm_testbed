options:
  parameters:
    author: Do Hai Son
    catch_exceptions: 'True'
    category: '[GRC Hier Blocks]'
    cmake_opt: ''
    comment: BER test with regenerate capability
    copyright: ''
    description: ''
    gen_cmake: 'On'
    gen_linking: dynamic
    generate_options: qt_gui
    hier_block_src_path: '.:'
    id: test_BER
    max_nouts: '0'
    output_language: python
    placement: (0,0)
    qt_qss_theme: ''
    realtime_scheduling: ''
    run: 'True'
    run_command: '{python} -u {filename}'
    run_options: prompt
    sizing_mode: fixed
    thread_safe_setters: ''
    title: Test BER block
    window_size: (1000,800)
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [8, 8]
    rotation: 0
    state: enabled

blocks:
- name: avg_len
  id: variable
  parameters:
    comment: Fixed averaging window
    value: '100000'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [528, 12]
    rotation: 0
    state: enabled
- name: ber_percent
  id: variable_qtgui_range
  parameters:
    comment: BER from 0.001% to 100%
    gui_hint: 0,0,1,1
    label: Expected BER (%)
    min_len: '200'
    orient: QtCore.Qt.Horizontal
    rangeType: float
    start: '0.0'
    step: '0.00001'
    stop: '1'
    value: '0.01'
    widget: counter_slider
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [344, 12.0]
    rotation: 0
    state: true
- name: pattern_len
  id: variable
  parameters:
    comment: Length of pattern to generate
    value: '50000'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [528, 100.0]
    rotation: 0
    state: enabled
- name: regenerate_trigger
  id: variable_qtgui_push_button
  parameters:
    comment: Button to regenerate pattern
    gui_hint: 1,0,1,1
    label: Regenerate Pattern
    pressed: '1'
    released: '0'
    type: int
    value: '0'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [672, 12.0]
    rotation: 0
    state: true
- name: samp_rate
  id: variable
  parameters:
    comment: ''
    value: '100000'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [200, 12.0]
    rotation: 0
    state: enabled
- name: blocks_multiply_const_vxx_0
  id: blocks_multiply_const_vxx
  parameters:
    affinity: ''
    alias: ''
    comment: ''
    const: '1'
    maxoutbuf: '0'
    minoutbuf: '0'
    type: float
    vlen: '1'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [864, 228.0]
    rotation: 0
    state: enabled
- name: blocks_throttle_0
  id: blocks_throttle
  parameters:
    affinity: ''
    alias: ''
    comment: Control data rate
    ignoretag: 'True'
    maxoutbuf: '0'
    minoutbuf: '0'
    samples_per_second: samp_rate
    type: byte
    vlen: '1'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [344, 244.0]
    rotation: 0
    state: true
- name: epy_block_0
  id: epy_block
  parameters:
    _source_code: "import numpy as np\nfrom gnuradio import gr\nimport random\n\n\
      class blk(gr.sync_block):\n    \"\"\"Generate reference and received bits with\
      \ variable error rate\"\"\"\n\n    def __init__(self, error_rate=0.10, pattern_len=50000):\n\
      \        gr.sync_block.__init__(\n            self,\n            name='BER Pattern\
      \ Generator',\n            in_sig=[],\n            out_sig=[np.uint8, np.uint8]\
      \  # ref and rx outputs\n        )\n        self.error_rate = error_rate\n \
      \       self.prev_error_rate = error_rate\n        self.pattern_len = pattern_len\n\
      \        self.index = 0\n        \n        self.need_regen = True\n        #\
      \ Generate initial pattern\n        self.regenerate_pattern()\n    \n    def\
      \ regenerate_pattern(self):\n        \"\"\"Generate new reference and received\
      \ patterns\"\"\"\n        random.seed()  # Use current time as seed\n      \
      \  \n        # Generate random reference bits\n        self.ref_bits = [random.randint(0,\
      \ 1) for _ in range(self.pattern_len)]\n        \n        # Generate received\
      \ bits with errors\n        self.rx_bits = []\n        for bit in self.ref_bits:\n\
      \            if random.random() < self.error_rate:\n                # Inject\
      \ error\n                self.rx_bits.append(1 - bit)\n            else:\n \
      \               # No error\n                self.rx_bits.append(bit)\n     \
      \   \n        self.index = 0\n        self.need_regen = False\n        print(f\"\
      Generated {self.pattern_len} bits with {self.error_rate*100:.3f}% error rate\"\
      )\n\n    def work(self, input_items, output_items):\n        # Check if we need\
      \ to regenerate before producing output\n\n        if (self.error_rate != self.prev_error_rate):\n\
      \            self.need_regen = True\n            self.prev_error_rate = self.error_rate\n\
      \        \n        if self.need_regen:\n            print(\"Regenerating pattern\
      \ in work()...\")\n            self.regenerate_pattern()\n        \n       \
      \ out_ref = output_items[0]\n        out_rx = output_items[1]\n        \n  \
      \      for i in range(len(out_ref)):\n            out_ref[i] = self.ref_bits[self.index]\n\
      \            out_rx[i] = self.rx_bits[self.index]\n            self.index =\
      \ (self.index + 1) % self.pattern_len\n        \n        return len(out_ref)\n"
    affinity: ''
    alias: ''
    comment: Generates synchronized ref and rx bits
    error_rate: ber_percent
    maxoutbuf: '0'
    minoutbuf: '0'
    pattern_len: pattern_len
  states:
    _io_cache: ('BER Pattern Generator', 'blk', [('error_rate', '0.1'), ('pattern_len',
      '50000')], [], [('0', 'byte', 1), ('1', 'byte', 1)], 'Generate reference and
      received bits with variable error rate', ['error_rate', 'pattern_len'])
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [128, 488.0]
    rotation: 0
    state: disabled
- name: import_random
  id: import
  parameters:
    alias: ''
    comment: ''
    imports: import random
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [200, 100.0]
    rotation: 0
    state: true
- name: ofdm_testbed_ber_0
  id: ofdm_testbed_ber
  parameters:
    affinity: ''
    alias: ''
    avg_len: avg_len
    comment: ''
    enable_output: 'True'
    maxoutbuf: '0'
    minoutbuf: '0'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [584, 328.0]
    rotation: 0
    state: true
- name: ofdm_testbed_ber_pattern_generator_0
  id: ofdm_testbed_ber_pattern_generator
  parameters:
    affinity: ''
    alias: ''
    comment: ''
    error_rate: ber_percent
    maxoutbuf: '0'
    minoutbuf: '0'
    pattern_len: '50000'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [32, 240.0]
    rotation: 0
    state: true
- name: qtgui_number_sink_0
  id: qtgui_number_sink
  parameters:
    affinity: ''
    alias: ''
    autoscale: 'False'
    avg: '0'
    color1: ("blue", "red")
    color10: ("black", "black")
    color2: ("black", "black")
    color3: ("black", "black")
    color4: ("black", "black")
    color5: ("black", "black")
    color6: ("black", "black")
    color7: ("black", "black")
    color8: ("black", "black")
    color9: ("black", "black")
    comment: ''
    factor1: '100'
    factor10: '1'
    factor2: '1'
    factor3: '1'
    factor4: '1'
    factor5: '1'
    factor6: '1'
    factor7: '1'
    factor8: '1'
    factor9: '1'
    graph_type: qtgui.NUM_GRAPH_HORIZ
    gui_hint: 2,0,1,1
    label1: Measured BER
    label10: ''
    label2: ''
    label3: ''
    label4: ''
    label5: ''
    label6: ''
    label7: ''
    label8: ''
    label9: ''
    max: '1'
    min: '0'
    name: '"Current BER"'
    nconnections: '1'
    type: float
    unit1: '%'
    unit10: ''
    unit2: ''
    unit3: ''
    unit4: ''
    unit5: ''
    unit6: ''
    unit7: ''
    unit8: ''
    unit9: ''
    update_time: '0.10'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [1072, 236.0]
    rotation: 0
    state: true
- name: qtgui_time_sink_x_0
  id: qtgui_time_sink_x
  parameters:
    affinity: ''
    alias: ''
    alpha1: '1.0'
    alpha10: '1.0'
    alpha2: '1.0'
    alpha3: '1.0'
    alpha4: '1.0'
    alpha5: '1.0'
    alpha6: '1.0'
    alpha7: '1.0'
    alpha8: '1.0'
    alpha9: '1.0'
    autoscale: 'False'
    axislabels: 'True'
    color1: blue
    color10: dark blue
    color2: red
    color3: green
    color4: black
    color5: cyan
    color6: magenta
    color7: yellow
    color8: dark red
    color9: dark green
    comment: ''
    ctrlpanel: 'False'
    entags: 'True'
    grid: 'True'
    gui_hint: 3,0,3,1
    label1: Measured BER
    label10: Signal 10
    label2: Signal 2
    label3: Signal 3
    label4: Signal 4
    label5: Signal 5
    label6: Signal 6
    label7: Signal 7
    label8: Signal 8
    label9: Signal 9
    legend: 'True'
    marker1: '-1'
    marker10: '-1'
    marker2: '-1'
    marker3: '-1'
    marker4: '-1'
    marker5: '-1'
    marker6: '-1'
    marker7: '-1'
    marker8: '-1'
    marker9: '-1'
    name: '"BER vs Time"'
    nconnections: '1'
    size: '10000'
    srate: samp_rate
    stemplot: 'False'
    style1: '1'
    style10: '1'
    style2: '1'
    style3: '1'
    style4: '1'
    style5: '1'
    style6: '1'
    style7: '1'
    style8: '1'
    style9: '1'
    tr_chan: '0'
    tr_delay: '0'
    tr_level: '0.0'
    tr_mode: qtgui.TRIG_MODE_FREE
    tr_slope: qtgui.TRIG_SLOPE_POS
    tr_tag: '""'
    type: float
    update_time: '0.10'
    width1: '2'
    width10: '1'
    width2: '1'
    width3: '1'
    width4: '1'
    width5: '1'
    width6: '1'
    width7: '1'
    width8: '1'
    width9: '1'
    ylabel: BER
    ymax: '1'
    ymin: '0'
    yunit: '""'
  states:
    bus_sink: false
    bus_source: false
    bus_structure: null
    coordinate: [848, 412.0]
    rotation: 0
    state: true

connections:
- [blocks_multiply_const_vxx_0, '0', qtgui_number_sink_0, '0']
- [blocks_throttle_0, '0', ofdm_testbed_ber_0, '0']
- [epy_block_0, '0', blocks_throttle_0, '0']
- [epy_block_0, '1', ofdm_testbed_ber_0, '1']
- [ofdm_testbed_ber_0, '0', blocks_multiply_const_vxx_0, '0']
- [ofdm_testbed_ber_0, '0', qtgui_time_sink_x_0, '0']
- [ofdm_testbed_ber_pattern_generator_0, '0', blocks_throttle_0, '0']
- [ofdm_testbed_ber_pattern_generator_0, '1', ofdm_testbed_ber_0, '1']

metadata:
  file_format: 1
